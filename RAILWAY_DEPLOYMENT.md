# TravelEase - Railway Deployment Guide

This guide provides step-by-step instructions for deploying TravelEase to Railway.

## Why Railway?

Railway is a modern deployment platform that offers:
- **Easy PostgreSQL integration** - Built-in database provisioning
- **Automatic builds** - Detects Next.js and configures automatically
- **Simple environment management** - Easy-to-use dashboard
- **Free tier** - Great for MVPs and testing
- **Fast deployments** - Quick build and deploy times

## Prerequisites

1. **Railway Account**: Sign up at https://railway.app (free tier available)
2. **GitHub Repository**: Your TravelEase code pushed to GitHub
3. **OpenWeatherMap API Key**: Get free key from https://openweathermap.org/api

## Quick Deployment (5 minutes)

### Step 1: Create Railway Project

1. Go to https://railway.app/new
2. Click **"Deploy from GitHub repo"**
3. Select your **Tschiffer46/Travelease** repository
4. Railway will automatically detect it's a Next.js project

### Step 2: Add PostgreSQL Database

1. In your Railway project dashboard, click **"+ New"**
2. Select **"Database"**
3. Choose **"Add PostgreSQL"**
4. Railway automatically creates a `DATABASE_URL` variable

### Step 3: Configure Environment Variables

In your Railway project dashboard, go to **Variables** tab and add:

```bash
# Database (automatically created by Railway PostgreSQL service)
DATABASE_URL=postgresql://...  # Auto-generated by Railway

# NextAuth (update URL after first deployment)
NEXTAUTH_URL=https://your-app.up.railway.app
NEXTAUTH_SECRET=generate-with-openssl-rand-base64-32

# Weather API (required for destination recommendations)
OPENWEATHER_API_KEY=your-openweathermap-api-key

# Stripe (optional - for payment processing)
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Node Environment
NODE_ENV=production
```

### Step 4: Deploy

1. Click **"Deploy"** in Railway dashboard
2. Railway will:
   - Install dependencies
   - Run `npm run build`
   - Generate Prisma client
   - Start the application with `npm start`

3. Wait for deployment (usually 2-3 minutes)
4. You'll get a URL like: `https://your-app.up.railway.app`

### Step 5: Initialize Database

After first deployment, initialize your database:

1. In Railway dashboard, go to your service
2. Click **"Settings"** â†’ **"Raw Editor"**
3. Or use Railway CLI:

```bash
# Install Railway CLI
npm i -g @railway/cli

# Login
railway login

# Link to your project
railway link

# Run database migrations
railway run npm run db:push

# Seed the database
railway run npm run db:seed
```

### Step 6: Update NEXTAUTH_URL

1. Copy your Railway app URL
2. Go back to **Variables** tab
3. Update `NEXTAUTH_URL` with your actual Railway URL
4. Railway will automatically redeploy

## Alternative: Railway CLI Deployment

### Install Railway CLI

```bash
npm install -g @railway/cli
```

### Login and Deploy

```bash
# Login to Railway
railway login

# Initialize Railway project (in your repo directory)
cd /path/to/Travelease
railway init

# Add PostgreSQL
railway add

# Set environment variables
railway variables set NEXTAUTH_SECRET=your-secret
railway variables set OPENWEATHER_API_KEY=your-api-key

# Deploy
railway up

# Initialize database
railway run npm run db:push
railway run npm run db:seed
```

## Environment Variables Reference

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string | Auto-generated by Railway |
| `NEXTAUTH_URL` | Your Railway app URL | `https://your-app.up.railway.app` |
| `NEXTAUTH_SECRET` | Secret for NextAuth.js | Generate with `openssl rand -base64 32` |
| `OPENWEATHER_API_KEY` | Weather API key | Get from openweathermap.org |

### Optional Variables

| Variable | Description | Needed For |
|----------|-------------|------------|
| `STRIPE_SECRET_KEY` | Stripe API key | Payment processing |
| `STRIPE_PUBLISHABLE_KEY` | Stripe public key | Payment processing |
| `STRIPE_WEBHOOK_SECRET` | Stripe webhook secret | Payment webhooks |
| `NODE_ENV` | Environment mode | Set to `production` |

## Post-Deployment Checklist

### Immediate Verification (5 minutes)

- [ ] Visit your Railway URL
- [ ] Homepage loads correctly
- [ ] Browse products at `/products`
- [ ] Test destination search on homepage
- [ ] Add items to cart at `/cart`
- [ ] Verify TSA liquid calculator works
- [ ] Access admin dashboard at `/admin`

### Database Verification

```bash
# Check database connection
railway run npx prisma studio

# View products
railway run npx prisma db seed

# Check migrations
railway run npx prisma migrate status
```

### Monitor Logs

```bash
# View application logs
railway logs

# Follow logs in real-time
railway logs -f
```

## Railway Features

### Custom Domains

1. Go to **Settings** â†’ **Networking**
2. Click **"Generate Domain"** for a Railway subdomain
3. Or add your **Custom Domain**
4. Update `NEXTAUTH_URL` after domain change

### Auto-Deployments

Railway automatically deploys when you push to your main branch:

```bash
git push origin main
# Railway detects push and starts deployment
```

### Monitoring

1. **Metrics**: View CPU, memory, and network usage
2. **Logs**: Real-time application logs
3. **Deployments**: History of all deployments
4. **Usage**: Track resource consumption

### Scaling

Railway automatically scales based on your plan:
- **Free Tier**: $5 of usage per month
- **Developer Plan**: $10/month with $10 credit
- **Pro Plan**: $20/month with $20 credit

## Troubleshooting

### Build Fails

**Error: "Prisma Client not generated"**
```bash
# Verify postinstall script in package.json
"postinstall": "prisma generate"
```

**Error: "DATABASE_URL not found"**
- Check PostgreSQL service is added
- Verify DATABASE_URL variable exists
- Check service is linked correctly

### Runtime Errors

**Error: "Can't connect to database"**
1. Verify PostgreSQL service is running
2. Check DATABASE_URL format
3. Ensure services are in same project

**Error: "OpenWeatherMap API error"**
- Verify API key is correct
- Check API rate limits
- App works without it (shows generic recommendations)

### Performance Issues

**Slow initial load**
- Railway cold starts can take 30s-1min
- Consider upgrading to keep service always running
- Use Railway's "Always On" feature

**Database connection issues**
- Railway PostgreSQL is within same network
- Connection should be fast
- Check connection pooling settings

## Cost Estimation

### Free Tier
- $5 of usage per month (enough for MVP testing)
- Includes:
  - Next.js app hosting
  - PostgreSQL database
  - 512MB RAM
  - 1GB storage

### Developer Plan ($10/month)
- $10/month + $10 usage credit
- Better for production use
- More resources
- Custom domains

### Typical Monthly Cost (Estimate)
- **Development/Testing**: $0-5 (free tier)
- **Production (small)**: $10-15
- **Production (medium)**: $20-30

## Railway vs Vercel Comparison

| Feature | Railway | Vercel |
|---------|---------|--------|
| **Next.js Support** | âœ… Excellent | âœ… Native |
| **PostgreSQL** | âœ… Built-in | âš ï¸ Separate service |
| **Pricing** | $5/month free | Free tier (commercial limits) |
| **Database** | Included | Extra service needed |
| **Setup Time** | 5 minutes | 5 minutes |
| **CLI Tools** | Railway CLI | Vercel CLI |
| **Learning Curve** | Easy | Very Easy |

## Support & Resources

- **Railway Documentation**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **Railway Status**: https://status.railway.app
- **Railway Blog**: https://blog.railway.app

## Next Steps After Deployment

### Week 1
1. âœ… Verify all features work
2. âœ… Add custom domain
3. âœ… Monitor logs and metrics
4. âœ… Set up automatic backups

### Week 2
1. Configure production database
2. Add more products via admin
3. Set up error monitoring (Sentry)
4. Configure email notifications

### Week 3
1. Implement Stripe payments
2. Add user authentication
3. Set up analytics
4. Optimize performance

## Emergency Rollback

If deployment has issues:

```bash
# Rollback to previous deployment
railway rollback

# Or via dashboard:
# Go to Deployments â†’ Select working deployment â†’ Click "Rollback"
```

## Database Backup

```bash
# Backup database
railway run pg_dump $DATABASE_URL > backup.sql

# Restore database
railway run psql $DATABASE_URL < backup.sql
```

## Success Metrics

Your deployment is successful when:

âœ… Homepage loads in under 2 seconds
âœ… Products page displays all items
âœ… Cart functionality works
âœ… TSA calculator displays correctly
âœ… Admin dashboard accessible
âœ… Database queries respond quickly
âœ… No errors in Railway logs

---

**ðŸš€ Your TravelEase app is now live on Railway!**

**Railway URL**: `https://your-app.up.railway.app`

Share with your team and start testing! ðŸŽ‰
